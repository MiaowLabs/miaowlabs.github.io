---
layout: wiki
title: 软件框架讲解-裸机版本
---

# {{ page.title }}

> 作者：Songyimiao

MWbalanced是最早使用STC15系列单片机作为控制芯片的两轮自平衡小车项目。MWbalanced控制源代码，都是属于一砖一瓦敲出来的。没有移植嵌入式实时操作系统（RTOS）的源代码，我们称之为裸机代码，托管在[Github](https://github.com/MiaowLabs/MWbalanced-firmware-none)，命名方式为为"MWbalanced-firmware-none"，尾缀none表示未使用操作系统，裸奔的意思。

现在结合裸机代码，来说说MWbalanced的软件框架。

##软件流程图

MWbalanced软件流程如下图所示：


MWbalanced控制芯片使用的是STC15系列单片机，没有一直实时操作系统，依靠中断嵌套来完成整体功能。程序核心就是通过定时器，在主循环中通过不断查询判断各个条件，这样就产生了几个大小不一样的时间段，我们根据需要就可以完成以多久更新一次传感器数据、多久更新一次控制等需要实现的功能，尽可能的利用主控的资源。

##初始化

进入主函数之后，就是STC15的各种外设和GPIO的初始化。


接着，进入主循环while(1)之中。主循环是整个程序功能实现的关键，程序进入这里面就在里面循环运行了。当然，中断来时，会打断主循环去运行中断服务程序，完事后再跳回到主循环运行。

##主循环-125Hz循环

待续。


